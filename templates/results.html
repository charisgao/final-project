<!DOCTYPE html>
<html>

<head>
    <title>Results</title>
    <link rel="stylesheet" type="text/css" href="static/css/style.css?q={{ time }}" />
    <style>
        #map {
            margin-left: 20%;
            height: 500px;
            width: 50%;
        }
    </style>
</head>

<body>
    <h1>Data!</h1>
    <h2 id = "restHeader">Restaurants</h2>
    <ul>
        {% for biz in restaurants %}
        <li>{{ biz["name"] }}</li>
        {% endfor %}
    </ul>
    <h2 id = "hotelsHeader">Hotels</h2>
    <ul>
        {% for biz in hotels %}
        <li>{{ biz["name"] }}</li>
        {% endfor %}
    </ul>
    <h2 id = "thingsHeader">Things To Do</h2>
    <ul>
        {% for biz in thingstodo %}
        <li>{{ biz["name"] }}</li>
        {% endfor %}
    </ul>
    <div id="map"></div>

    <script>
        function initMap() {
            let restaurants = JSON.parse('{{ restaurants | tojson }}');
            let hotels = JSON.parse('{{ hotels | tojson }}');
            let thingstodo = JSON.parse('{{ thingstodo | tojson }}');
            var center = { lat: restaurants[0]["coordinates"]["latitude"], lng: restaurants[0]["coordinates"]["longitude"] };

            var map = new google.maps.Map(document.getElementById("map"), {
                zoom: 10,
                center: center
            });

            var infowindow = new google.maps.InfoWindow({});
            var marker, count;

            // restaurants
            for (count = 0; count < restaurants.length; count++) {
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(restaurants[count]["coordinates"]["latitude"], restaurants[count]["coordinates"]["longitude"]),
                    map: map,
                    title: restaurants[count]["name"],
                    icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
                });

                google.maps.event.addListener(marker, 'click', (function (marker, count) {
                    return function () {
                        infowindow.setContent(restaurants[count]["name"]);
                        infowindow.open(map, marker);
                    }
                })(marker, count));
            }

            // hotels
            for (count = 0; count < hotels.length; count++) {
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(hotels[count]["coordinates"]["latitude"], hotels[count]["coordinates"]["longitude"]),
                    map: map,
                    title: hotels[count]["name"],
                    icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                });

                google.maps.event.addListener(marker, 'click', (function (marker, count) {
                    return function () {
                        infowindow.setContent(hotels[count]["name"]);
                        infowindow.open(map, marker);
                    }
                })(marker, count));
            }

            // thingstodo
            for (count = 0; count < thingstodo.length; count++) {
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(thingstodo[count]["coordinates"]["latitude"], thingstodo[count]["coordinates"]["longitude"]),
                    map: map,
                    title: thingstodo[count]["name"],
                    icon: "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
                });

                google.maps.event.addListener(marker, 'click', (function (marker, count) {
                    return function () {
                        infowindow.setContent(thingstodo[count]["name"]);
                        infowindow.open(map, marker);
                    }
                })(marker, count));
            }
        }

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key={{ google_key }}&callback=initMap">
    </script>
</body>

</html>